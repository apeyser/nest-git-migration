language: cpp
compiler: gcc

cache:
  - ccache
  - apt

env:
    - xGSL=GSL- xMPI=MPI- xPYTHON=PYTHON-
    # xGSL=GSL- xMPI=MPI- xPYTHON=PYTHON+
    # xGSL=GSL- xMPI=MPI+ xPYTHON=PYTHON-
    # xGSL=GSL- xMPI=MPI+ xPYTHON=PYTHON+
    # xGSL=GSL+ xMPI=MPI- xPYTHON=PYTHON-
    # xGSL=GSL+ xMPI=MPI- xPYTHON=PYTHON+
    # xGSL=GSL+ xMPI=MPI+ xPYTHON=PYTHON-
    # xGSL=GSL+ xMPI=MPI+ xPYTHON=PYTHON+

matrix:
 fast_finish: true

before_install: |
  echo $LANG
  echo $LC_ALL
  sudo apt-get update
  sudo apt-get install -y \
       llvm-3.4 llvm-3.4-dev \
       python3 ipython3 coreutils gawk mawk original-awk \
       devscripts build-essential \
       texlive-latex-extra \
       clang indent \
       python-debian python-numpy python-scipy python-virtualenv \
       python-matplotlib python-tk \
       python-coverage python-nose python-setuptools \
       python-mpi4py openmpi-dev openmpi-bin \
       python3 python3-all-dev python3-dev python3-numpy python3-scipy \
       python3-nose cython \
       texlive texlive-latex-base texlive-latex3 ghostscript \
       autoconf automake libtool libltdl-dev \
       libgsl0-dev  libghc-readline-dev \
       python-django python-django-tagging python-httplib2 python-simplejson \
       python-svn git-svn \
       python-cheetah python-jinja2 python-mock \
       python-tk python-gmpy python-imaging python-imaging-tk \
       python \
       cvs e2fsprogs gettext libpackagekit-glib2-dev groff libssh2-1-dev \
       python-libssh2 slang-gsl libncurses5-dev check

script: ./build.sh

notifications:
  email:
    recipients:
      - a.peyser@fz-juelich.de
    on_success: change
    on_failure: always

before_deploy: tar cvf reports.tar $TRAVIS_BUILD_DIR/reports

deploy:
  provider: releases
  api_key:
    secure: bpwv/Rn6mtXR67OdApRvh9dCKCMW1X5tKKZbbxZneaO2uVjG/pWn445BZn9NzC1KhKCcbbLpYc0ECH/FC7bwVSKBD1wDvwncyheWbEqnLLtbRSNOZBTsNypJTeZwHekxzCmimWvZEVD2d0PSjsy7GhYrnmBoaioSg8qtsauK8nk=
  file: reports.tar
  skip_cleanup: true
  on:
    repo: apeyser/nest-git-migration
    tags: true
